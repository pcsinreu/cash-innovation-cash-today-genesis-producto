trigger:
  branches:
    include:
      - develop

pool:
  vmImage: 'windows-latest'

variables:
  buildConfiguration: 'Release'

steps:
- checkout: self
  persistCredentials: true
  fetchDepth: 1

- task: NuGetToolInstaller@1

- task: NuGetCommand@2
  inputs:
    restoreSolution: 'IAC/Prosegur.Global.GesEfectivo.IAC/Prosegur.Global.GesEfectivo.IAC.Web.vbproj'

- task: NuGetCommand@2
  inputs:
    restoreSolution: 'NuevoSaldos/Prosegur.Global.GesEfectivo.NS.Web/Prosegur.Global.GesEfectivo.NuevoSaldos.Web.vbproj'

- task: VSBuild@1
  inputs:
    solution: 'IAC/Prosegur.Global.GesEfectivo.IAC/Prosegur.Global.GesEfectivo.IAC.Web.vbproj'
    msbuildArgs: '/p:Configuration=$(buildConfiguration) /p:TargetFrameworkVersion=v4.8'
    platform: 'Any CPU'
    configuration: '$(buildConfiguration)'

- task: VSBuild@1
  inputs:
    solution: 'NuevoSaldos/Prosegur.Global.GesEfectivo.NS.Web/Prosegur.Global.GesEfectivo.NuevoSaldos.Web.vbproj'
    msbuildArgs: '/p:Configuration=$(buildConfiguration) /p:TargetFrameworkVersion=v4.8'
    platform: 'Any CPU'
    configuration: '$(buildConfiguration)'

- task: CopyFiles@2
  inputs:
    SourceFolder: 'IAC/Prosegur.Global.GesEfectivo.IAC/Web/bin/Release'
    Contents: '**'
    TargetFolder: '$(Build.ArtifactStagingDirectory)/iac_build'

- task: CopyFiles@2
  inputs:
    SourceFolder: 'NuevoSaldos/Prosegur.Global.GesEfectivo.NS.Web/bin/Release'
    Contents: '**'
    TargetFolder: '$(Build.ArtifactStagingDirectory)/ns_build'
